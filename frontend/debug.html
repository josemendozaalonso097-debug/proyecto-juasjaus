<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Sesi√≥n</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .box {
            background: #2d2d2d;
            border: 2px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #00ff00;
            color: #1e1e1e;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #00cc00;
        }
        .output {
            background: #000;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 14px;
            overflow-x: auto;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffff00; }
        h1 { color: #00ff00; text-align: center; }
        h3 { color: #00ccff; }
        pre { margin: 0; }
    </style>
</head>
<body>
    <h1>üîç DEBUG - SISTEMA DE SESIONES</h1>
    
    <div class="box">
        <h3>1. Probar Servidor</h3>
        <button onclick="testServer()">üîå Test Servidor</button>
        <div id="server-output" class="output"></div>
    </div>

    <div class="box">
        <h3>2. Crear Usuario de Prueba</h3>
        <button onclick="testRegister()">‚úçÔ∏è Registrar Usuario</button>
        <div id="register-output" class="output"></div>
    </div>

    <div class="box">
        <h3>3. Verificar Sesi√≥n</h3>
        <button onclick="testSession()">üîê Check Session</button>
        <div id="session-output" class="output"></div>
    </div>

    <div class="box">
        <h3>4. Ver Cookies</h3>
        <button onclick="showCookies()">üç™ Ver Cookies</button>
        <div id="cookies-output" class="output"></div>
    </div>

    <div class="box">
        <h3>5. Cerrar Sesi√≥n</h3>
        <button onclick="testLogout()">üö™ Logout</button>
        <div id="logout-output" class="output"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api/auth';

        function log(elementId, message, type = 'success') {
            const output = document.getElementById(elementId);
            output.innerHTML = `<pre class="${type}">${message}</pre>`;
        }

        async function testServer() {
            log('server-output', '‚è≥ Probando servidor...', 'warning');
            try {
                const response = await fetch('http://localhost:5000/api/test');
                const data = await response.json();
                log('server-output', `‚úÖ Servidor OK\n${JSON.stringify(data, null, 2)}`, 'success');
            } catch (error) {
                log('server-output', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testRegister() {
            log('register-output', '‚è≥ Registrando usuario...', 'warning');
            
            const timestamp = Date.now();
            const testUser = {
                nombre: 'Test User',
                email: `test_${timestamp}@example.com`,
                password: 'password123'
            };

            try {
                const response = await fetch(`${API_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify(testUser)
                });

                const data = await response.json();
                
                if (data.success) {
                    log('register-output', 
                        `‚úÖ Usuario registrado exitosamente\n` +
                        `Email: ${testUser.email}\n` +
                        `Password: ${testUser.password}\n` +
                        `\nRespuesta del servidor:\n${JSON.stringify(data, null, 2)}`,
                        'success'
                    );
                } else {
                    log('register-output', `‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                log('register-output', `‚ùå Error de red: ${error.message}`, 'error');
            }
        }

        async function testSession() {
            log('session-output', '‚è≥ Verificando sesi√≥n...', 'warning');
            
            try {
                const response = await fetch(`${API_URL}/check-session`, {
                    credentials: 'include'
                });

                const data = await response.json();
                
                if (data.authenticated) {
                    log('session-output', 
                        `‚úÖ Sesi√≥n activa\n${JSON.stringify(data, null, 2)}`,
                        'success'
                    );
                } else {
                    log('session-output', 
                        `‚ö†Ô∏è No hay sesi√≥n activa\n${JSON.stringify(data, null, 2)}`,
                        'warning'
                    );
                }
            } catch (error) {
                log('session-output', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        function showCookies() {
            const cookies = document.cookie;
            
            if (cookies) {
                const cookieList = cookies.split(';').map(c => c.trim()).join('\n');
                log('cookies-output', `üç™ Cookies del navegador:\n\n${cookieList}`, 'success');
            } else {
                log('cookies-output', '‚ö†Ô∏è No hay cookies almacenadas', 'warning');
            }
        }

        async function testLogout() {
            log('logout-output', '‚è≥ Cerrando sesi√≥n...', 'warning');
            
            try {
                const response = await fetch(`${API_URL}/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });

                const data = await response.json();
                
                if (data.success) {
                    log('logout-output', `‚úÖ Sesi√≥n cerrada\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    log('logout-output', `‚ùå Error: ${data.message}`, 'error');
                }
            } catch (error) {
                log('logout-output', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Auto-ejecutar al cargar
        window.onload = function() {
            console.log('üîç P√°gina de debug cargada');
            testServer();
        };
    </script>
</body>
</html>